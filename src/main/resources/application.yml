server:
  port: 8080
  shutdown: graceful

spring:
  application:
    name: ai-rag-orchestrator


  # ==============================================================
  # ORACLE DATABASE CONFIGURATION
  # ==============================================================
  datasource:
    url: jdbc:oracle:thin:@//${DB_HOST:localhost}:1521/${DB_SERVICE:XE}
    username: ${DB_USER:autoflow}
    password: ${DB_PASS:autoflow123}
    driver-class-name: oracle.jdbc.OracleDriver
##    hikari:
##      maximum-pool-size: 20
##      minimum-idle: 5
##      connection-timeout: 30000
##      # Oracle Validation Query
##      connection-test-query: SELECT 1 FROM DUAL
#
  jpa:
    open-in-view: false
    show-sql: false
    hibernate:
      ddl-auto: validate # Use 'update' in development, # Use 'validate' in production
    properties:
      hibernate:
        dialect: org.hibernate.dialect.OracleDialect
        format_sql: true

# ==============================================================
# CUSTOM APP PROPERTIES
# ==============================================================
app:
  workspace-dir: ${WORKSPACE_DIR:/tmp/ai-orchestrator-workspace}
  git:
    default-prefix: "feature/"
    prefixes:
      "Story": "feature/"
      "Bug": "bugfix/"
    # Git provider URL parsing strategies
    providers:
      github:
        pattern: "github.com"
        branch-separator: "/tree/"
        default-branch: "main"
      gitlab:
        pattern: "gitlab.com"
        branch-separator: "/-/tree/"
        default-branch: "main"
      bitbucket:
        pattern: "bitbucket.org"
        branch-separator: "/src/"
        default-branch: "master"
      azure:
        pattern: "dev.azure.com"
        branch-separator: "?version=GB"
        default-branch: "main"
  jira:
    base-url: https://${JIRA_DOMAIN}.atlassian.net
    username: ${JIRA_USER}
    token: ${JIRA_TOKEN}
    fields:
      repo-name-field-id: customfield_10141
      repo-url-field-id: customfield_10142
      base-branch-field-id: customfield_10144
      acceptance-criteria-field-id: customfield_10143

  bitbucket:
    base-url: https://api.bitbucket.org/2.0
    workspace: ${BITBUCKET_WORKSPACE}
    username: ${BITBUCKET_USER}
    app-password: ${BITBUCKET_PASS}
    api-username: ${BITBUCKET_API_USER}

  gemini:
    api-key: ${GEMINI_KEY}
    chat-model: gemini-flash-latest
    embedding-model: text-embedding-004
    # Temperature settings per agent type
    default-temperature: 0.7
    json-temperature: 0.2  # Lower for structured JSON output
    agent-temperatures:
      code-generator: 0.3  # More deterministic for code generation
      documentation: 0.8   # More creative for documentation
      scope-discovery: 0.5 # Balanced for discovery
      requirement-analyzer: 0.0  # Fully deterministic for classification
    # Retry configuration
    retry:
      max-attempts: 3
      initial-backoff-seconds: 2
      max-backoff-seconds: 30
      multiplier: 2.0
      retryable-status-codes: [429, 500, 502, 503, 504]

  # ==============================================================
  # CODE QUALITY & GENERATION SETTINGS
  # ==============================================================
  code-quality:
    max-complexity: 10
    max-method-lines: 20
    max-parameters: 4
    max-nesting-depth: 3
    enforce-interface-pattern: true
    enforce-immutable-dtos: true
    forbid-null-returns: true
    forbid-if-else-chains: true
    min-if-else-for-strategy: 3  # Use Strategy pattern if 3+ branches

    compilation:
      enabled: true
      max-attempts: 3
      timeout-seconds: 30
      fail-on-warnings: false

    static-analysis:
      checkstyle-enabled: true
      pmd-enabled: true
      fail-on-violations: true

  # ==============================================================
  # WEB SEARCH FOR LATEST LIBRARY APIs
  # ==============================================================
  web-search:
    enabled: ${WEB_SEARCH_ENABLED:false}
    provider: tavily  # Options: tavily, serpapi, google
    api-key: ${TAVILY_API_KEY:}
    max-results: 5
    timeout-seconds: 10
    # Trigger web search if compilation error matches these patterns
    trigger-patterns:
      - "cannot find symbol"
      - "incompatible types"
      - "deprecated"
      - "package .* does not exist"

  # ==============================================================
  # RETRY CONFIGURATION (Global defaults)
  # ==============================================================
  retry:
    max-attempts: 3
    backoff-ms: 1000
    max-backoff-ms: 10000
    multiplier: 2.0

  # ==============================================================
  # AGENT-SPECIFIC CONFIGURATIONS
  # ==============================================================
  agents:
    # Scope Discovery Agent - Search and similarity thresholds
    scope-discovery:
      max-files: 7
      max-classes: 3
      max-chunks: 10
      max-dependencies: 5
      similarity:
        min-threshold: 0.5
        max-threshold: 0.8
        min-matches: 3
        significant-gap: 0.15
        top-score-multiplier: 0.7
      default-architecture: "Spring Boot MVC"

    # Requirement Analyzer - Confidence thresholds
    requirement-analyzer:
      min-confidence: 0.7

    # Context Builder - Token budget and confidence
    context-builder:
      min-confidence: 0.9
      ask-user-below-threshold: true
      max-token-budget: 10000

    # Build Validator - Retry and timeout
    build:
      max-retry-attempts: 3
      timeout-minutes: 10

    # PR Reviewer - Retry configuration
    code-review:
      max-retry-attempts: 2

    # Documentation Agent - Limits for code retrieval
    documentation:
      max-code-matches: 10
      max-fallback-nodes: 20
      max-log-preview: 5

    # Test Runner - OS-specific shell configuration
    test-runner:
      shell-windows: "cmd.exe"
      shell-flag-windows: "/c"
      shell-unix: "sh"
      shell-flag-unix: "-c"
      test-command: "mvn -B test"
      timeout-minutes: 30


# ==============================================================
# NEO4J SPRING PROPERTIES
# ==============================================================
neo4j:
  uri: ${NEO4J_URI:bolt://localhost:7687}
  authentication:
    username: ${NEO4J_USER:neo4j}
    password: ${NEO4J_PASSWORD:password}

logging:
  level:
    root: INFO
    com.purchasingpower.autoflow: DEBUG
    com.purchasingpower.autoflow.workflow.agents: DEBUG
    org.bsc.langgraph4j: DEBUG