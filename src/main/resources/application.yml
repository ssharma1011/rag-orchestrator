server:
  port: 8080
  shutdown: graceful

spring:
  application:
    name: ai-rag-orchestrator

  # ==============================================================
  # ORACLE DATABASE CONFIGURATION
  # ==============================================================
  datasource:
    url: jdbc:oracle:thin:@//${DB_HOST:localhost}:1521/${DB_SERVICE:XE}
    username: ${DB_USER:autoflow}
    password: ${DB_PASS:autoflow123}
    driver-class-name: oracle.jdbc.OracleDriver
    # FIXED: Increased pool size to prevent deadlocks during multi-threaded indexing
    hikari:
      maximum-pool-size: 30
      minimum-idle: 10
      connection-timeout: 30000
      connection-test-query: SELECT 1 FROM DUAL

  jpa:
    open-in-view: false
    show-sql: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
#        dialect: org.hibernate.dialect.OracleDialect
        format_sql: true

  # ==============================================================
  # NEO4J CONFIGURATION
  # ==============================================================
  neo4j:
    uri: ${NEO4J_URI:bolt://localhost:7687}
    authentication:
      username: ${NEO4J_USER:neo4j}
      password: ${NEO4J_PASSWORD:password}

# ==============================================================
# CUSTOM APP PROPERTIES
# ==============================================================
app:
  # LLM PROVIDER OPTIONS:
  #   'gemini' - Fast cloud API (429 rate limit issues)
  #   'ollama' - Local model (7B is fast, 32B is slow)
  #   'hybrid' - Ollama for tool selection (fast), Gemini for final response (quality)
  llm-provider: ${LLM_PROVIDER:hybrid}  # HYBRID: Ollama for tools, Gemini for final response

  workspace-dir: ${WORKSPACE_DIR:/tmp/ai-orchestrator-workspace}

  # ==============================================================
  # OLLAMA CONFIGURATION (Local AI)
  # ==============================================================
  ollama:
    base-url: http://localhost:11434
    chat-model: qwen2.5-coder:7b  # UPGRADED: Better explanations (was 1.5b)
    embedding-model: mxbai-embed-large
    num-ctx: 32768  # Large context for viewing entire classes
    timeout-seconds: 120  # LangChain4j: Request timeout
    max-retries: 3  # LangChain4j: Automatic retries on failure

  # ==============================================================
  # GEMINI CONFIGURATION (Cloud Backup)
  # ==============================================================
  gemini:
    api-key: ${GEMINI_KEY}
    chat-model: gemini-flash-latest
    embedding-model: text-embedding-004
    default-temperature: 0.7
    json-temperature: 0.2
    agent-temperatures:
      code-generator: 0.3
      documentation: 0.8
      scope-discovery: 0.5
      requirement-analyzer: 0.0
    retry:
      max-attempts: 6
      initial-backoff-seconds: 10
      max-backoff-seconds: 65

  git:
    default-prefix: "feature/"
    prefixes:
      "Story": "feature/"
      "Bug": "bugfix/"
    providers:
      github:
        pattern: "github.com"
        branch-separator: "/tree/"
        default-branch: "main"
      gitlab:
        pattern: "gitlab.com"
        branch-separator: "/-/tree/"
        default-branch: "main"
      bitbucket:
        pattern: "bitbucket.org"
        branch-separator: "/src/"
        default-branch: "master"
      azure:
        pattern: "dev.azure.com"
        branch-separator: "?version=GB"
        default-branch: "main"

  jira:
    base-url: https://${JIRA_DOMAIN}.atlassian.net
    username: ${JIRA_USER}
    token: ${JIRA_TOKEN}
    fields:
      repo-name-field-id: customfield_10141
      repo-url-field-id: customfield_10142
      base-branch-field-id: customfield_10144
      acceptance-criteria-field-id: customfield_10143

  bitbucket:
    base-url: https://api.bitbucket.org/2.0
    workspace: ${BITBUCKET_WORKSPACE}
    username: ${BITBUCKET_USER}
    app-password: ${BITBUCKET_PASS}
    api-username: ${BITBUCKET_API_USER}

  # ==============================================================
  # CODE QUALITY & GENERATION SETTINGS
  # ==============================================================
  code-quality:
    max-complexity: 10
    max-method-lines: 20
    max-parameters: 4
    max-nesting-depth: 3
    enforce-interface-pattern: true
    enforce-immutable-dtos: true
    forbid-null-returns: true
    forbid-if-else-chains: true
    min-if-else-for-strategy: 3

    compilation:
      enabled: true
      max-attempts: 3
      timeout-seconds: 30
      fail-on-warnings: false

    static-analysis:
      checkstyle-enabled: true
      pmd-enabled: true
      fail-on-violations: true

  # ==============================================================
  # WEB SEARCH SETTINGS
  # ==============================================================
  web-search:
    enabled: ${WEB_SEARCH_ENABLED:false}
    provider: tavily
    api-key: ${TAVILY_API_KEY:}
    max-results: 5
    timeout-seconds: 10
    trigger-patterns:
      - "cannot find symbol"
      - "incompatible types"
      - "deprecated"
      - "package .* does not exist"

  # ==============================================================
  # AGENT-SPECIFIC CONFIGURATIONS
  # ==============================================================
  agents:
    scope-discovery:
      max-files: 7
      max-classes: 3
      max-chunks: 10
      max-dependencies: 5
      similarity:
        min-threshold: 0.5
        max-threshold: 0.8
        min-matches: 3
        significant-gap: 0.15
        top-score-multiplier: 0.7
      default-architecture: "Spring Boot MVC"

    requirement-analyzer:
      min-confidence: 0.7

    context-builder:
      min-confidence: 0.9
      ask-user-below-threshold: true
      max-token-budget: 15000

    build:
      max-retry-attempts: 3
      timeout-minutes: 10

    code-review:
      max-retry-attempts: 2

    documentation:
      max-code-matches: 10
      max-fallback-nodes: 20
      max-log-preview: 5

    test-runner:
      shell-windows: "cmd.exe"
      shell-flag-windows: "/c"
      shell-unix: "sh"
      shell-flag-unix: "-c"
      test-command: "mvn -B test"
      timeout-minutes: 30

logging:
  level:
    root: INFO
    com.purchasingpower.autoflow: DEBUG
    com.purchasingpower.autoflow.workflow.agents: DEBUG
    org.bsc.langgraph4j: DEBUG
    org.springframework.web.reactive.function.client.WebClient: WARN